const nodemailer = require('nodemailer');
const mailgen=require('mailgen');

const express = require('express');
const logger = require('./Logger.js');
const emailconfig = require('../../json/emailconfig.json');


function SendEmailNotiification(api,date,site,location,environment){	
	let transport = nodemailer.createTransport({
		host: '192.168.193.193',
		port: 25,
		ignoreTLS: true,
		secure:false
	});		
	var mailGenerator = new mailgen({
		theme: 'salted',
		product: {
			name: 'Index Monitor',
			link: 'http://ec2-34-211-56-128.us-west-2.compute.amazonaws.com/login'
		}
	});
	var email = {
    body: {
			name: 'Support Team',
			intro: eval(emailconfig[api]['Intro']),
			action: {
				instructions: 'To check the indexing history, please click here:',
				button: {
					color: '#22BC66',
					text: 'Costco-Lucid Api Console',
					link: 'http://ec2-18-220-54-17.us-east-2.compute.amazonaws.com/login'
				}
			},
			outro: 'This is an autogenerated email from Costco Index Monitoring application. Please do not reply to this email.'
		}
	};
	var emailBody = mailGenerator.generate(email);
	
	const message = {
		from:emailconfig[api]['From'],
		to:emailconfig[api]['To'],
		cc:emailconfig[api]['CC'],
		subject: emailconfig[api]['Subject'],
		html: emailBody
	};	
	
	transport.sendMail(message,function(err,info){
		if(err){
			logger.error(err);
		}
		else{
			logger.info(info);
		}
	});
}

module.exports.SendEmailNotiification =  SendEmailNotiification;